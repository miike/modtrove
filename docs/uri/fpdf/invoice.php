<?phpdefine('FPDF_FONTPATH','font/');require('fpdf.php');function getaddress($contact,$address){$sql = "SELECT * FROM contact where id = ".$contact;	$result = runQuery($sql,'getdata');	$contact = mysql_fetch_array($result);$sql = "SELECT * FROM contact_address where id = ".$address;	$result = runQuery($sql,'getdata');	$address = mysql_fetch_array($result);if($contact[sname])	$ret = $contact['title']." ".$contact[fname]." ".$contact[sname]."\n";if($address[address])	$ret .= $address['address']."\n";if($address[town])	$ret .= $address['town'];	if($address[county])	$ret .= ", ".$address['county'];$ret .= "\n";if($address[country]!= 'UK')	$ret .= $address['country']."\n";return $ret;}function dateconvert($date,$in = 'sql',$out = 'dis'){	if($in =='sql'){	      $newdate = mktime ( 0, 0, 0, substr($date,8,2), substr($date,5,2), substr($date,0,4) );		}				if($out=='dis'){			$outdate = date("d/m/Y",$newdate);		}			return($outdate);	}function runQuery($sql, $query_desc) {    // Connecting, selecting database  $link = mysql_pconnect('localhost','root','theseus');    if (!$link) return false;     // else echo "An error occurred while attempting to connect to the database.";    mysql_select_db('bluerhinos') or die("Could not select database");    // Run the query.    $result = mysql_query($sql);    if (!$result) {        // Get the error message.        $err_msg = mysql_error();        $email = "andrew@bluerhinos.co.uk";        echo "<hr />\n";        echo "<p>There was a problem running the <b>$query_desc</b> query. Please report the message ";        echo "below to the <a href=\"mailto:$email\">webmaster</a>, telling them when and where the problem occurred.</p>";        echo "<pre><b>ERROR MESSAGE:</b>\n$err_msg</pre>";        echo "<hr />\n";    }    return $result;}function leadzero($val,$no){	$noneed = $no - strlen($val);	for($i=0;$i<$noneed;$i++){		$val = "0".$val;	}	return $val;}class PDF extends FPDF{//Page headerfunction Header(){	$this->Image('img/logo.jpg', 10, 10, 100);	$this->SetLineWidth(0.4);	$this->SetDrawColor(51,102,153);	$this->Rect(8,8,194,14);	$this->SetTextColor(51,102,153);	$this->SetFont('Arial','',8);	$text = "57 Kitchener Rd";	$this->Text(175,12,$text);	$text = "Southamptom";	$this->Text(177,16,$text);	$text = "SO17 3SF";	$this->Text(180,20,$text);}//Page footerfunction Footer(){	$this->SetLineWidth(0.4);	$this->SetDrawColor(51,102,153);	$this->Rect(8,284,194,5);	$this->SetTextColor(51,102,153);	$this->SetFont('Arial','',8);	$text = "Email: sales@bluerhinos.co.uk Phone: 07739 904006";	$this->Text(70,287.5,$text);}function printthispage($orderid){	$sql = "SELECT * FROM invoice where id = 1";	$result = runQuery($sql,'getdata');	$datab = mysql_fetch_array($result);		$sql = "SELECT * FROM clients where id = ".$datab[custid];	$result = runQuery($sql,'getdata');	$custdata =  mysql_fetch_array($result);	$this->AddPage();	$this->SetFont('Futura','',26);	$text = "INVOICE";	$this->Text(10,35,$text);	    //Right boxes       	$this->SetX(142);  	$this->SetY(35);        	$this->SetFont('Futura','',10);       	$rightbit[0][0] = "Invoice No:";    $rightbit[0][1] = $custdata[code].leadzero($datab['no'],4);    $rightbit[1][0] = "Invoice Date:";    $rightbit[1][1] = dateconvert($datab['date'],'sql','dis');    $rightbit[2][0] = "Customer ID:";    $rightbit[2][1] = $custdata[code];    $rightbit[3][0] = "";    $rightbit[3][1] = "";    $rightbit[4][0] = "Order Date:";    $rightbit[4][1] = dateconvert($datab['orderdate'],'sql','dis');;    $rightbit[5][0] = "Your Order No:";    $rightbit[5][1] = $datab['yordno'];    $rightbit[6][0] = "Our order No:";    $rightbit[6][1] = $datab['oordno'];                foreach($rightbit as $right){       	$this->SetX(147);	$this->SetTextColor(51,102,153);     $this->Cell(25,4,$right[0],0,0,'L',0);    $this->SetTextColor(0);    $this->Cell(30,4,$right[1],0,0,'R',0);    $this->Ln();   	}		$this->SetY(70);    $this->SetX(8);        $billto = getaddress($custdata[contact],$custdata[address]);    $shipto = "N/A";        $this->SetTextColor(51,102,153);     $this->Cell(70,4,'Bill To:',0,0,'L',0);    $this->Ln();       $this->SetX(8);	$this->SetTextColor(0);    $this->MultiCell(70,4,$billto,0,'L',0);        	$this->SetY(70);	$this->SetX(80);        	$this->SetTextColor(51,102,153);     $this->Cell(70,4,'Ship To:',0,0,'L',0);    $this->Ln();       $this->SetX(80);	$this->SetTextColor(0);    $this->MultiCell(70,4,$shipto,0,'L',0);    				$this->SetY(100);	//Column titles	$header=array('Quantity','Item','Description','Unit Price','Total Price');		$sql = "SELECT * FROM invoice_bits Where invoice_id = ".$datab[id];	$result = runQuery($sql,'getdata');	$ii=0;	while($dataa =  mysql_fetch_array($result)){	$data[$ii][0] = $dataa[qty];	$data[$ii][1] = $dataa[item];	$data[$ii][2] = $dataa[desc];	$data[$ii][3] = $dataa[unit];	$data[$ii][4] = $dataa[qty] * $dataa[unit];	if($datab[vat]){		$data[$ii][5] = "*";		$totals[vat] += $dataa[qty] * $dataa[unit];	}		$totals[tot] += $dataa[qty] * $dataa[unit];	$ii++;	}		//Data loading	$bot[0][0] = "Subtotal";	$bot[0][1] = $totals[tot];	$bot[1][0] = "Shipping";	$bot[1][1] = $datab[shipping]+0;	if($datab[shipvat])		$totals[vat] += $datab[shipping]; 	$bot[2][0] = "Miscellanious";	$bot[2][1] = $datab[misc]+0;	if($datab[miscvat])		$totals[vat] += $datab[misc]; 		$bot[3][0] = "VAT*";	$bot[3][1] = $totals[VAT]*0.175;	$bot[4][0] = "Balance Due";	$bot[4][1] = $totals[tot] + ($totals[VAT]*0.175);			$this->FancyTable($header,$data, $bot);}function FancyTable($header,$data,$bot){    //Colors, line width and bold font    $this->SetTextColor(51,102,153);    $this->SetDrawColor(51,102,153);    $this->SetLineWidth(.4);    $this->SetFont('','','10');        	$this->SetX(8);    $w=array(30,30,74,30,30);    for($i=0;$i<count($header);$i++)        $this->Cell($w[$i],8,$header[$i],1,0,'C',0);    $this->Ln();    //Color and font restoration    $this->SetFillColor(255,55,255);    $this->SetTextColor(0);    $this->SetFont('','','10');    //Data    $fill=0;        $w=array(30,30,74,30,26,4);    for($g=0;$g<10;$g++){    $row = $data[$g];            		$this->SetX(8);		if($row[0]){        $this->Cell($w[0],8,$row[0],'1',0,'L',$fill);        $this->Cell($w[1],8,$row[1],'1',0,'L',$fill);        $this->Cell($w[2],8,$row[2],'1',0,'L',$fill);        $this->Cell($w[3],8,number_format($row[3],2),'1',0,'R',$fill);        $this->Cell($w[4],8,number_format($row[4],2),'TLB',0,'R',$fill);        $this->Cell($w[5],8,$row[5],'TRB',0,'R',$fill);        }else{        $this->Cell($w[0],8,'','1',0,'L',$fill);        $this->Cell($w[1],8,'','1',0,'L',$fill);        $this->Cell($w[2],8,'','1',0,'L',$fill);        $this->Cell($w[3],8,'','1',0,'R',$fill);        $this->Cell($w[4],8,'','TLB',0,'R',$fill);        $this->Cell($w[5],8,'','TRB',0,'R',$fill);                }        $this->Ln();    }    //$this->Cell(array_sum($w),0,'','T');foreach($bot as $bit){		$this->SetX(8);		$this->Cell($w[0],8,'','0',0,'L',$fill);        $this->Cell($w[1],8,'','0',0,'L',$fill);        $this->Cell($w[2],8,'','0',0,'L',$fill);        $this->Cell($w[3],8,$bit[0],'1',0,'L',$fill);        if($bit[1]){        $this->Cell($w[4],8,number_format($bit[1],2),'TBL',0,'R',$fill);        $this->Cell($w[5],8,$bit[2],'TRB',0,'R',$fill);		}else{		$this->Cell($w[4]+$w[5],8,'','1',0,'R',$fill);		}        $this->Ln();}		$this->Ln();		$disc = "Please pay within 14 days \n*Please note that we are not VAT registered and that VAT displayed is only carries forwarded from our suppliers, if any VAT applies please find a copy of the suppliers invoice. Please make cheques payable to 'Andrew Milsted'. Money can be transferred via paypal to 'andrew@bluerhinos.co.uk' or directly in to our bank account, Account No: 16351800, Sort  Code: 60-80-06. Many Thanks.";		$this->SetX(8);		$this->MultiCell(192,4,$disc,0,'L',0);}}//start output$pdf=new PDF('P','mm','a4');$pdf->AddFont('Futura','','futural.php');$pdf->printthispage($_REQUEST[id]);$pdf->Output();?>